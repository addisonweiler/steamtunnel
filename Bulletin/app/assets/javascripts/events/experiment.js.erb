//# Change text when favorite link clicked on
$(document).ready( function() {
  bindEvents();
  // Fading notices
  $('p.notice, p.alert').delay(500).fadeIn('normal', function() {
      $(this).delay(2500).fadeOut();
   });
  $('#date_selected').change(postDateSelection);
  // Show info and description
});

bindEvents = function() {
  $('.favorite, .unfavorite').bind('click', toggleFavorite); // Favorites button in details panel
  $('.event').children('.info').show();
  $('.event').children('.description').show();
}

// Changes text of Favorite link, both in event stream and in details
// TODO Favoriting detailed event should update link both in stream and in details
toggleFavorite = function(e) {
  if($(e.target).is("a") ){
    var text = (e.target.innerHTML == "Favorite") ? "Unfavorite" : "Favorite"
    e.target.innerHTML = text
    e.target.className = 
      e.target.className.replace( /(?:^|\s)favorite(?!\S)/ , text.toLowerCase() )
  }
}

postDateSelection = function() {
  elem = $(this).children(':selected')
  var value = $(elem).text()
  var date = {"date": value};
  // Post so cookie can store checked routes
  <% url = Rails.application.routes.url_helpers %>
  var path = "<%= url.stumble_events_path %>";
  console.log('path')
  $.ajax({
    url: path + "?date=" + value,
    type: 'get',
    dataType: 'script',
    success: bindEvents,
  });
}