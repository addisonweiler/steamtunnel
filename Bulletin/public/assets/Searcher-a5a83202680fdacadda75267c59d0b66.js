function Searcher(){function i(a){d.empty(),e=null,c.hide(),a?c.filter(":Contains('"+a+"')").show():c.show()}function j(a){var c=a.keyCode?a.keyCode:a.which;if(c==h.ESCAPE){b.blur();return}if(d.children().length===0)return;switch(c){case h.DOWN:e?(e.removeClass("hover"),e.next("a").length!==0&&(e=e.next())):e=d.children("a:first"),e.addClass("hover");break;case h.UP:e?(e.removeClass("hover"),e.prev("a").length!==0&&(e=e.prev())):e=d.children("a:first"),e.addClass("hover");break;case h.ENTER:if(!e)break;window.location=e.attr("href");break;default:}}function k(a){g&&g.abort();if(!b.val())return;g=$.ajax({url:"/search",dataType:"json",type:"get",cache:!0,data:{query:a},error:function(a,b,c){console.log(["Error:",a,b,c]);if(b!="abort"){d.children(".none-found").remove();var e="Server error";$.trim(c)&&(e+=": "+c),d.append("<li class='error'>"+e+"</li>")}},success:function(a,b,c){console.log(["AJAX Data: "],a),d.empty(),$.each(a,function(a,b){d.append(l(b))}),a.length||d.append("<li class='none-found'>No results found.</li>")}})}function l(a){var b=a.visible_name,c=a.id;return"<a href='"+c+"' class='a-result'>"+b+"</a>"}var a,b,c,d,e=null,f=null,g=null,h={BACKSPACE:8,TAB:9,ENTER:13,CONTROL:17,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COLON:186,COMMA:188};this.search=function(a){i(a)},this.setupInterface=function(){a=$("#search-wrapper"),b=a.children("#search-input"),d=a.children("#results"),c=$(".event"),$blind=$("<div id='blind' />").appendTo(document.body).css({position:"fixed",left:0,top:0,right:0,bottom:0,"z-index":-1,"background-color":"black",opacity:.6}).hide(),$("#logo-img").css({"z-index":105}),c.css({position:"relative","z-index":101}),b.css({position:"relative","z-index":102}),b.bind("focus",function(){$blind.fadeIn().css("z-index",100),$(this).animate({width:240,"margin-left":"-=30"},200)}).bind("blur",function(){$blind.fadeOut().css("z-index",-1),$(this).animate({width:180,"margin-left":"+=30"},200)}),b.bind("search",function(){i(b.val())}),b.bind("change",function(){i(b.val())}),d.delegate("a","mouseenter.Searcher",function(){if(e&&e.get(0)===$(this).get(0))return;e&&e.removeClass("hover"),e=$(this),e.addClass("hover")}),b.keydown(function(a){j(a)})},this.setupInterface()}jQuery.expr[":"].Contains=function(a,b,c){return jQuery.trim(a.textContent||a.innerText||"").toUpperCase().indexOf(jQuery.trim(c[3]).toUpperCase())>=0}